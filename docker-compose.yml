version: '3.8'

services:
  backend:
    build: ./backend
    container_name: financeapp-backend
    restart: always
    ports:
      - "8001:8000"
    volumes:
      - ./financeapp_data:/app/data
    environment:
      # Use SQLite in a volume path that persists
      - DATABASE_URL=sqlite:///./data/financeapp.db
      - SECRET_KEY=change-this-secret-key-in-production-please
      - ALGORITHM=HS256
      - ACCESS_TOKEN_EXPIRE_MINUTES=60
      # Allow frontend CORS
      - FRONTEND_URL=http://localhost:5000

  frontend:
    build: ./frontend
    container_name: financeapp-frontend
    restart: always
    ports:
      - "5000:5000"
      - "80:5000"  # Expose simply on port 80 for easy access if available
    environment:
      # In Docker network, backend is accessible via service name 'backend'
      - API_URL=http://backend:8000
      - FLASK_ENV=production
      - SECRET_KEY=change-this-frontend-secret-key
    depends_on:
      - backend
